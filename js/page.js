!function(){"use strict";const t=new Promise((t=>{function e(){"loading"!==document.readyState&&t()}document.addEventListener("readystatechange",e),e()})),e=document.createRange();function s(t){return e.createContextualFragment(String(t)).children[0]}e.selectNode(document.documentElement);const i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function n(t,...e){return e=e.map((t=>String(t).replace(/[&<>"'/]/g,(t=>i[t])))),t.reduce(((t,s,i)=>t+s+(e[i]||"")),"")}function o(t){return new Response(t).text()}function r({removeClass:t=!1}={}){return(e,s="active",i="transition")=>{const n=e.classList.contains(s);if(t){if(!n)return Promise.resolve()}else if(n)return Promise.resolve();const o=new Promise((n=>{const o=t=>{t.target===e&&(e.removeEventListener("transitionend",o),e.classList.remove(i),n())};e.classList.add(i),requestAnimationFrame((()=>{e.addEventListener("transitionend",o),e.classList[t?"remove":"add"](s)}))})),r=new Promise((t=>{setTimeout(t,1e3)}));return Promise.race([o,r])}}const a=r(),c=r({removeClass:!0});const h=(()=>{let t;async function e(e,s){const i=await(t||(t=new Promise(((t,e)=>{const s=indexedDB.open("svgo-keyval",1);s.onerror=()=>{e(s.error)},s.onupgradeneeded=()=>{s.result.createObjectStore("keyval")},s.onsuccess=()=>{t(s.result)}})),t));return new Promise(((t,n)=>{const o=i.transaction("keyval",e);o.oncomplete=()=>t(),o.onerror=()=>n(o.error),s(o.objectStore("keyval"))}))}return{async get(t){let s;return await e("readonly",(e=>{s=e.get(t)})),s.result},set:(t,s)=>e("readwrite",(e=>{e.put(s,t)})),delete:t=>e("readwrite",(e=>{e.delete(t)}))}})();class l{constructor(t){this._requestId=0,this._pending={},this._url=t,this._worker=null}release(){this._abortPending(),this._worker&&(this._worker.terminate(),this._worker=null)}requestResponse(t){return new Promise(((e,s)=>{t.id=++this._requestId,this._pending[t.id]=[e,s],this._worker||this._startWorker(),this._worker.postMessage(t)}))}abort(){0!==Object.keys(this._pending).length&&(this._abortPending(),this._worker&&this._worker.terminate(),this._startWorker())}_abortPending(){for(const t of Object.keys(this._pending))this._fulfillPending(t,null,new DOMException("AbortError","AbortError"))}_startWorker(){this._worker=new Worker(this._url),this._worker.onmessage=t=>this._onMessage(t)}_onMessage(t){t.data.id?this._fulfillPending(t.data.id,t.data.result,t.data.error&&new Error(t.data.error)):console.log("Unexpected message",t)}_fulfillPending(t,e,s){const i=this._pending[t];i?(delete this._pending[t],s?i[1](s):i[0](e)):console.log("No resolver for",{id:t,result:e,error:s})}}const d=new class extends l{constructor(){super("js/gzip-worker.js")}compress(t){return this.requestResponse({data:t})}};class u{constructor(t,e,s){this.text=t,this._compressedSize=null,this._url=null,this.width=e,this.height=s}async size({compress:t}){return t?(this._compressedSize||(this._compressedSize=d.compress(this.text).then((t=>t.byteLength))),this._compressedSize):this.text.length}get url(){return this._url||(this._url=URL.createObjectURL(new Blob([this.text],{type:"image/svg+xml"}))),this._url}release(){this._url&&URL.revokeObjectURL(this._url)}}function _(t){return{x:t.pageX,y:t.pageY}}function p(t,e){const s=Math.abs(e.x-t.x),i=Math.abs(e.y-t.y);return Math.hypot(s,i)}function v(t,e){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2}}function m(t){return t.touches?[...t.touches].map((t=>_(t))):[_(t)]}class g{constructor(t,{eventArea:e=t,shouldCaptureFunc:s=(()=>!0)}={}){this._target=t,this._shouldCaptureFunc=s,this._dx=0,this._dy=0,this._scale=1,this._active=0,this._lastPoints=[],this._onPointerDown=t=>{"mousedown"===t.type&&0!==t.button||this._shouldCaptureFunc(t.target)&&(t.preventDefault(),this._lastPoints=m(t),this._active++,1===this._active&&this._onFirstPointerDown())},this._onPointerMove=t=>{t.preventDefault();const e=m(t),s=e.reduce(v),i=this._lastPoints.reduce(v),{left:n,top:o}=this._target.getBoundingClientRect();if(this._dx+=s.x-i.x,this._dy+=s.y-i.y,e[1]){const t=p(e[0],e[1])/p(this._lastPoints[0],this._lastPoints[1]);this._scale*=t,this._dx-=(s.x-n)*(t-1),this._dy-=(s.y-o)*(t-1)}this._update(),this._lastPoints=e},this._onPointerUp=t=>{t.preventDefault(),this._active--,this._lastPoints.pop(),this._active?this._lastPoints=m(t):(document.removeEventListener("mousemove",this._onPointerMove),document.removeEventListener("mouseup",this._onPointerUp),document.removeEventListener("touchmove",this._onPointerMove),document.removeEventListener("touchend",this._onPointerUp))},e.addEventListener("mousedown",this._onPointerDown),e.addEventListener("touchstart",this._onPointerDown),e.addEventListener("wheel",(t=>this._onWheel(t)))}reset(){this._dx=0,this._dy=0,this._scale=1,this._update()}_onWheel(t){if(!this._shouldCaptureFunc(t.target))return;t.preventDefault();const{left:e,top:s}=this._target.getBoundingClientRect();let i=t.deltaY;1===t.deltaMode&&(i*=15),i=Math.max(Math.min(i,60),-60);const n=i/300+1;this._scale*n<.05||(this._scale*=n,this._dx-=(t.pageX-e)*(n-1),this._dy-=(t.pageY-s)*(n-1),this._update())}_onFirstPointerDown(){document.addEventListener("mousemove",this._onPointerMove),document.addEventListener("mouseup",this._onPointerUp),document.addEventListener("touchmove",this._onPointerMove),document.addEventListener("touchend",this._onPointerUp)}_update(){this._target.style.transform=`translate3d(${this._dx}px, ${this._dy}px, 0) scale(${this._scale})`}}class w{constructor(){this.container=s('<div class="svg-output"><div class="svg-container"><iframe class="svg-frame" sandbox="allow-scripts" scrolling="no" title="Loaded SVG file"></iframe></div></div>'),this._svgFrame=this.container.querySelector(".svg-frame"),this._svgContainer=this.container.querySelector(".svg-container"),t.then((()=>{this._panZoom=new g(this._svgContainer,{eventArea:this.container})}))}setSvg({text:t,width:e,height:s}){const i=this._nextLoadPromise();return this._svgFrame.src=`data:image/svg+xml,${encodeURIComponent(t)}`,this._svgFrame.style.width=`${e}px`,this._svgFrame.style.height=`${s}px`,i}reset(){this._svgFrame.src="about:blank",this._panZoom.reset()}_nextLoadPromise(){return new Promise((t=>{const e=()=>{this._svgFrame.removeEventListener("load",e),t()};this._svgFrame.addEventListener("load",e)}))}}const y=new class extends l{constructor(){super("js/prism-worker.js")}highlight(t){return this.requestResponse({data:t})}};class f{constructor(){this.container=s('<div class="code-output"><pre><code></code></pre></div>'),this._codeEl=this.container.querySelector("code")}async setSvg({text:t}){this._codeEl.innerHTML=await y.highlight(t)}reset(){this._codeEl.innerHTML=""}}class L{constructor(){this.container=s('<div class="output-switcher"></div>'),this._types={image:new w,code:new f},this._svgFile=null,this._switchQueue=Promise.resolve(),this.set("image",{noAnimate:!0})}update(t){return this._svgFile=t,this._types[this._activeType].setSvg(t)}reset(){this._types[this._activeType].reset()}set(t,{noAnimate:e=!1}={}){return this._switchQueue=this._switchQueue.then((async()=>{const s=this._activeType&&this._types[this._activeType].container;this._activeType=t;const i=this._types[this._activeType].container;if(this.container.append(i),this._svgFile&&await this.update(this._svgFile),e)i.classList.add("active"),s&&s.classList.remove("active");else{const t=[a(i)];s&&t.push(c(s)),await Promise.all(t)}s&&s.remove()})),this._switchQueue}}class E{constructor(){this.container=s('<span class="ripple"></span>')}animate(){this.container.classList.remove("animate"),this.container.offsetLeft,this.container.classList.add("animate")}}class k{constructor({title:t,href:e,iconSvg:i,major:n=!1}){this.container=s((e?"<a>":'<div role="button" tabindex="0">')+i+(e?"</a>":"</div>"));const o=["floating-action-button"];e&&(this.container.href=e),t&&this.container.setAttribute("title",t),n&&o.push("major-floating-action-button"),this.container.classList.add(...o),this._ripple=new E,this.container.append(this._ripple.container),this.container.addEventListener("click",(()=>this.onClick()))}onClick(){this._ripple.animate()}}class b{constructor(){this.container=s('<div class="spinner"><div class="spinner-container"><div class="spinner-layer"><div class="circle-clipper left"><div class="circle"></div></div><div class="gap-patch"><div class="circle"></div></div><div class="circle-clipper right"><div class="circle"></div></div></div></div></div>'),this._showTimeout=null,this.container.style.display="none",this.container.addEventListener("animationend",(t=>{t.target===this.container&&(this.container.style.display="none")}))}show(t=300){clearTimeout(this._showTimeout),this.container.style.display="none",this.container.classList.remove("cooldown"),this._showTimeout=setTimeout((()=>{this.container.style.display=""}),t)}hide(){clearTimeout(this._showTimeout),this.container.classList.add("cooldown")}}class x extends k{constructor(){super({title:"Download",href:"./",iconSvg:'<svg aria-hidden="true" class="icon" viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>',major:!0}),this._spinner=new b,this.container.append(this._spinner.container)}setDownload(t,{url:e}){this.container.download=t,this.container.href=e}working(){this._spinner.show(500)}done(){this._spinner.hide()}}class S extends k{constructor(){super({title:"Copy as text",iconSvg:'<svg aria-hidden="true" class="icon" viewBox="0 0 24 24"><path d="M16 1H4C3 1 2 2 2 3v14h2V3h12V1zm3 4H8C7 5 6 6 6 7v14c0 1 1 2 2 2h11c1 0 2-1 2-2V7c0-1-1-2-2-2zm0 16H8V7h11v14z"/></svg>'}),this._text=null,this._pre=document.createElement("pre")}onClick(t){super.onClick(t),this.copyText()}copyText(){if(!this._text)return!1;this._pre.textContent=this._text,document.body.append(this._pre),getSelection().removeAllRanges();const t=document.createRange();return t.selectNode(this._pre),window.getSelection().addRange(t),document.execCommand("copy"),getSelection().removeAllRanges(),this._pre.remove(),!0}setCopyText(t){this._text=t}}class C extends k{constructor(){super({title:"Preview on vivid background",iconSvg:'<svg aria-hidden="true" class="icon" viewBox="0 0 24 24"><path fill="currentColor" d="M21.143 9.667c-.733-1.392-1.914-3.05-3.617-4.753C14.549 1.936 12.048 1 10.741 1c-.414 0-.708.094-.86.246L8.52 2.606c-1.899-.236-3.42.106-4.294.983-.876.875-1.164 2.159-.792 3.523.492 1.806 2.305 4.049 5.905 5.375.038.323.157.638.405.885.588.588 1.535.586 2.121 0s.588-1.533.002-2.119a1.5 1.5 0 0 0-2.123-.001l-.17.256c-2.031-.765-3.395-1.828-4.232-2.9l3.879-3.875c.496 2.73 6.432 8.676 9.178 9.178l-7.115 7.107c-.234.153-2.798-.316-6.156-3.675-3.393-3.393-3.175-5.271-3.027-5.498L3.96 9.989C3.521 9.63 3.035 8.886 2.819 8.3L.685 10.431C.24 10.877 0 11.495 0 12.251c0 1.634 1.121 3.915 3.713 6.506C6.477 21.521 9.293 23 11.145 23c.648 0 1.18-.195 1.547-.562l8.086-8.078c.91.874-.778 3.538-.778 4.648a2 2 0 0 0 4-.001c0-3.184-1.425-6.81-2.857-9.34zM4.934 4.296c.527-.53 1.471-.791 2.656-.761L4.381 6.741c-.236-.978-.049-1.845.553-2.445zm9.292 4.079-.03-.029C12.904 7.054 10.393 3.99 11.1 3.283c.715-.715 3.488 1.521 5.062 3.096.862.862 2.088 2.247 2.937 3.458-1.717-1.074-3.491-1.469-4.873-1.462z"/></svg>'})}onClick(t){super.onClick(t),this.container.classList.contains("active")?(this.container.classList.remove("active"),this.setColor("transparent")):(this.container.classList.add("active"),this.setColor("rgba(0, 0, 0, 0.7)"))}setColor(t){document.documentElement.style.backgroundColor=t}}function U(t,e){const s=10**e;return Math.floor(Math.round(t*s))/s}function P(t){return t<1024?`${t} bytes`:`${U(t/1024,2)}k`}class F{constructor(){this.container=s('<div class="results"><span class="size"></span> <span class="diff"></span></div>'),this._sizeEl=this.container.querySelector(".size"),this._diffEl=this.container.querySelector(".diff")}update({size:t,comparisonSize:e}){this._sizeEl.textContent=e?`${P(e)} → ${P(t)}`:P(t),this._diffEl.classList.remove("decrease","increase"),e?t===e?this._diffEl.textContent="100%":(this._diffEl.textContent=`${U(t/e*100,2)}%`,this._diffEl.classList.add(t>e?"increase":"decrease")):this._diffEl.textContent=""}}let q=()=>({events:{},emit(t,...e){(this.events[t]||[]).forEach((t=>t(...e)))},on(t,e){return(this.events[t]=this.events[t]||[]).push(e),()=>this.events[t]=(this.events[t]||[]).filter((t=>t!==e))}});class D{constructor(t){this.container=s('<div class="material-slider"><div class="track"><div class="track-on"></div><div class="handle"><div class="arrow"></div><div class="val"></div></div></div></div>'),this._range=t,this._handle=this.container.querySelector(".handle"),this._trackOn=this.container.querySelector(".track-on"),this._val=this.container.querySelector(".val"),this._range.parentNode.insertBefore(this.container,this._range),this.container.insertBefore(this._range,this.container.firstChild),this._range.addEventListener("input",(()=>this._onInputChange())),this._range.addEventListener("mousedown",(()=>this._onRangeMouseDown())),this._range.addEventListener("touchstart",(()=>this._onRangeTouchStart())),this._range.addEventListener("touchend",(()=>this._onRangeTouchEnd())),this._setPosition()}set value(t){this._range.value=t,this._update()}_onRangeTouchStart(){this._range.focus()}_onRangeTouchEnd(){this._range.blur()}_onRangeMouseDown(){this._range.classList.add("active");const t=()=>{requestAnimationFrame((()=>{this._range.blur()})),this._range.classList.remove("active"),document.removeEventListener("mouseup",t)};document.addEventListener("mouseup",t)}_onInputChange(){this._update()}_update(){requestAnimationFrame((()=>this._setPosition()))}_setPosition(){const{min:t,max:e,value:s}=this._range,i=(Number(s)-t)/(e-t);this._trackOn.style.width=this._handle.style.left=100*i+"%",this._val.textContent=s}}class M{constructor(){this.emitter=q(),this._throttleTimeout=null,t.then((()=>{this.container=document.querySelector(".settings"),this._pluginInputs=[...this.container.querySelectorAll(".plugins input")],this._globalInputs=[...this.container.querySelectorAll(".global input")];const t=this.container.querySelector(".settings-scroller"),e=this.container.querySelector(".setting-reset"),s=this.container.querySelectorAll("input[type=range]");this._resetRipple=new E,e.append(this._resetRipple.container),this._sliderMap=new WeakMap;for(const t of s)this._sliderMap.set(t,new D(t));this.container.addEventListener("input",(t=>this._onChange(t))),e.addEventListener("click",(()=>this._onReset())),t.addEventListener("mousedown",(t=>{t.target.closest("input[type=range]")||t.preventDefault()}))}))}_onChange(t){clearTimeout(this._throttleTimeout),"range"===t.target.type?this._throttleTimeout=setTimeout((()=>this.emitter.emit("change")),150):this.emitter.emit("change")}_onReset(){this._resetRipple.animate();const t=this.getSettings();for(const t of this._globalInputs)"checkbox"===t.type?t.checked=t.hasAttribute("checked"):"range"===t.type&&(this._sliderMap.get(t).value=t.getAttribute("value"));for(const t of this._pluginInputs)t.checked=t.hasAttribute("checked");this.emitter.emit("reset",t),this.emitter.emit("change")}setSettings(t){for(const e of this._globalInputs)e.name in t&&("checkbox"===e.type?e.checked=t[e.name]:"range"===e.type&&(this._sliderMap.get(e).value=t[e.name]));for(const e of this._pluginInputs)e.name in t.plugins&&(e.checked=t.plugins[e.name])}getSettings(){const t=[],e={plugins:{}};for(const s of this._globalInputs)"gzip"!==s.name&&"original"!==s.name&&("checkbox"===s.type?t.push(Number(s.checked)):t.push(`|${s.value}|`)),e[s.name]="checkbox"===s.type?s.checked:s.value;for(const s of this._pluginInputs)t.push(Number(s.checked)),e.plugins[s.name]=s.checked;return e.fingerprint=t.join(","),e}}class I{constructor(){this.emitter=q(),this.allowHide=!1,this._spinner=new b,t.then((()=>{this.container=document.querySelector(".main-menu"),this._loadFileInput=this.container.querySelector(".load-file-input"),this._pasteInput=this.container.querySelector(".paste-input"),this._loadDemoBtn=this.container.querySelector(".load-demo"),this._loadFileBtn=this.container.querySelector(".load-file"),this._pasteLabel=this.container.querySelector(".menu-input"),this._overlay=this.container.querySelector(".overlay"),this._menu=this.container.querySelector(".menu");document.querySelector(".menu-btn").addEventListener("click",(t=>this._onMenuButtonClick(t))),this._overlay.addEventListener("click",(t=>this._onOverlayClick(t))),this._loadFileBtn.addEventListener("click",(t=>this._onLoadFileClick(t))),this._loadDemoBtn.addEventListener("click",(t=>this._onLoadDemoClick(t))),this._loadFileInput.addEventListener("change",(()=>this._onFileInputChange())),this._pasteInput.addEventListener("input",(()=>this._onTextInputChange()))}))}show(){this.container.classList.remove("hidden"),c(this._overlay,"hidden"),c(this._menu,"hidden")}hide(){this.allowHide&&(this.stopSpinner(),this.container.classList.add("hidden"),a(this._overlay,"hidden"),a(this._menu,"hidden"))}stopSpinner(){this._spinner.hide()}showFilePicker(){this._loadFileInput.click()}setPasteInput(t){this._pasteInput.value=t,this._pasteInput.dispatchEvent(new Event("input"))}_onOverlayClick(t){t.preventDefault(),this.hide()}_onMenuButtonClick(t){t.preventDefault(),this.show()}_onTextInputChange(){const t=this._pasteInput.value;t.includes("</svg>")&&(this._pasteInput.value="",this._pasteInput.blur(),this._pasteLabel.append(this._spinner.container),this._spinner.show(),this.emitter.emit("svgDataLoad",{data:t,filename:"image.svg"}))}_onLoadFileClick(t){t.preventDefault(),t.target.blur(),this.showFilePicker()}async _onFileInputChange(){const t=this._loadFileInput.files[0];t&&(this._loadFileBtn.append(this._spinner.container),this._spinner.show(),this.emitter.emit("svgDataLoad",{data:await o(t),filename:t.name}))}async _onLoadDemoClick(t){t.preventDefault(),t.target.blur(),this._loadDemoBtn.append(this._spinner.container),this._spinner.show();try{const t=await fetch("test-svgs/car-lite.svg").then((t=>t.text()));this.emitter.emit("svgDataLoad",{data:t,filename:"car-lite.svg"})}catch{this.stopSpinner();const t=new Error("serviceWorker"in navigator&&navigator.serviceWorker.controller?"Demo not available offline":"Couldn't fetch demo SVG");this.emitter.emit("error",{error:t})}}}class T{constructor(t,e,i,n){this.container=s('<div class="toast"><div class="toast-content"></div></div>');const o=this.container.querySelector(".toast-content");this._answerResolve=null,this._hideTimeout=null,n?(o.insertAdjacentHTML("afterbegin","<pre><code></code></pre>"),o.querySelector("code").textContent=t):o.textContent=t,this.answer=new Promise((t=>{this._answerResolve=t}));for(const t of i){const e=document.createElement("button");e.className="unbutton",e.textContent=t,e.type="button",e.addEventListener("click",(()=>{this._answerResolve(t)})),this.container.append(e)}e&&(this._hideTimeout=setTimeout((()=>this.hide()),e))}hide(){return clearTimeout(this._hideTimeout),this._answerResolve(),a(this.container,"hide")}}class R{constructor(){this.container=s('<div class="toasts"></div>')}show(t,{duration:e=0,buttons:s=["dismiss"],isError:i=!1}={}){const n=new T(t,e,s,i);return this.container.append(n.container),n.answer.then((()=>n.hide())).then((()=>{n.container.remove()})),n}}class z{constructor(){this.emitter=q(),this.container=s('<div class="drop-overlay">Drop it!</div>'),this._activeEnters=0,this._currentEnteredElement=null,t.then((()=>{document.addEventListener("dragover",(t=>t.preventDefault())),document.addEventListener("dragenter",(t=>this._onDragEnter(t))),document.addEventListener("dragleave",(()=>this._onDragLeave())),document.addEventListener("drop",(t=>this._onDrop(t)))}))}_onDragEnter(t){this._currentEnteredElement!==t.target&&(this._currentEnteredElement=t.target,this._activeEnters++||a(this.container))}_onDragLeave(){this._currentEnteredElement=null,--this._activeEnters||c(this.container)}async _onDrop(t){t.preventDefault(),this._activeEnters=0,c(this.container);const e=t.dataTransfer.files[0];e&&this.emitter.emit("svgDataLoad",{data:await o(e),filename:e.name})}}class B{constructor(){t.then((()=>{this.container=document.querySelector(".preloader"),this.activated=this.container.classList.contains("active"),this.hide()}))}async hide(){await c(this.container,"active"),this.container.style.display="none"}}class j{constructor(t){this.container=s('<section class="changelog"></section>'),this._loadedVersion=t}async showLogFrom(e){if(e===this._loadedVersion)return;const i=await fetch("changelog.json").then((t=>t.json()));let o=0,r=0;for(const[t,s]of Object.entries(i)){if(s.version===this._loadedVersion)o=t;else if(s.version===e)break;r=t+1}const c=i.slice(o,r).reduce(((t,e)=>t.concat(e.changes)),[]).map((t=>n`<li>${t}</li>`));this.container.append(s("<h1>Updated!</h1>"),s(`<ul>${c.join("")}</ul>`)),await t,a(this.container)}}class A{constructor(e){this._results=e,t.then((()=>{this._container=document.querySelector(".results-container"),this._mobileContainer=document.querySelector(".results-container-mobile"),this._query=matchMedia("(min-width: 640px)"),this._query.addListener((()=>this._positionResults())),this._positionResults()}))}_positionResults(){this._query.matches?this._container.append(this._results.container):this._mobileContainer.append(this._results.container)}}class ${constructor(){this.emitter=q(),this.container=null,t.then((()=>{this.container=document.querySelector(".view-toggler"),this.container.output[0].checked=!0,this.container.addEventListener("change",(()=>{this.emitter.emit("change",{value:this.container.output.value})}))}))}}class H{constructor(t){this._size=t,this.purge()}purge(){this._fingerprints=[],this._items=[],this._index=0}add(t,e){const s=this._items[this._index];s&&s.release(),this._fingerprints[this._index]=t,this._items[this._index]=e,this._index=(this._index+1)%this._size}match(t){return this._items[this._fingerprints.indexOf(t)]}}class O{constructor(...t){this._activated=!1,this._toActivate=t}activate(){if(!this._activated)return this._activated=!0,Promise.all(this._toActivate.map((t=>a(t))))}}const W=new class extends l{constructor(){super("js/svgo-worker.js"),this._currentJob=Promise.resolve()}async wrapOriginal(t){const{width:e,height:s}=await this.requestResponse({action:"wrapOriginal",data:t});return new u(t,e,s)}process(t,e){return this.abort(),this._currentJob=this._currentJob.catch((()=>{})).then((async()=>{const{data:s,dimensions:i}=await this.requestResponse({action:"process",settings:e,data:t});return new u(s,i.width,i.height)})),this._currentJob}};!function(){let t="mouse";document.body.addEventListener("focus",(e=>{e.target.classList.add("key"===t?"key-focused":"mouse-focused")}),!0),document.body.addEventListener("blur",(t=>{t.target.classList.remove("key-focused","mouse-focused")}),!0),document.body.addEventListener("keydown",(()=>{t="key"}),!0),document.body.addEventListener("mousedown",(()=>{t="mouse"}),!0)}(),new class{constructor(){this._mainUi=null,this._outputUi=new L,this._downloadButtonUi=new x,this._copyButtonUi=new S,this._resultsUi=new F,this._settingsUi=new M,this._mainMenuUi=new I,this._toastsUi=new R;const e=new C,s=new z,i=new B,n=new j(self.version);this._resultsContainerUi=new A(this._resultsUi);const o=new $;this._settingsUi.emitter.on("change",(()=>this._onSettingsChange())),this._settingsUi.emitter.on("reset",(t=>this._onSettingsReset(t))),this._mainMenuUi.emitter.on("svgDataLoad",(t=>this._onInputChange(t))),s.emitter.on("svgDataLoad",(t=>this._onInputChange(t))),this._mainMenuUi.emitter.on("error",(({error:t})=>this._handleError(t))),o.emitter.on("change",(t=>this._outputUi.set(t.value))),window.addEventListener("keydown",(t=>this._onGlobalKeyDown(t))),window.addEventListener("paste",(t=>this._onGlobalPaste(t))),window.addEventListener("copy",(t=>this._onGlobalCopy(t))),this._inputItem=null,this._cache=new H(10),this._latestCompressJobId=0,this._userHasInteracted=!1,this._reloading=!1,"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js",{scope:"./"}).then((t=>{t.addEventListener("updatefound",(()=>this._onUpdateFound(t)))})),h.get("last-seen-version").then((t=>{t&&n.showLogFrom(t),h.set("last-seen-version",self.version)})),t.then((()=>{const t=document.querySelector(".app-output"),o=t.querySelector(".action-button-container"),r=t.querySelector(".minor-action-container"),a=t.querySelector(".toolbar"),c=t.querySelector(".output"),h=t.querySelector(".menu-extra");this._mainUi=new O(a,o,this._outputUi.container,this._settingsUi.container),r.append(e.container,this._copyButtonUi.container),o.append(this._downloadButtonUi.container),c.append(this._outputUi.container),t.append(this._toastsUi.container,s.container),h.append(n.container),this._loadSettings(),i.activated&&this._toastsUi.show("Ready now!",{duration:3e3})}))}_onGlobalKeyDown(t){"o"===t.key&&(t.ctrlKey||t.metaKey)&&(t.preventDefault(),this._mainMenuUi.showFilePicker()),"Escape"===t.key&&this._mainMenuUi.hide()}_onGlobalPaste(t){const e=t.clipboardData.getData("text");e.includes("</svg>")?(this._mainMenuUi.setPasteInput(e),t.preventDefault()):this._toastsUi.show("Pasted value not an SVG",{duration:2e3})}_onGlobalCopy(t){window.getSelection().isCollapsed&&(this._toastsUi.show(this._copyButtonUi.copyText()?"Copy successful":"Nothing to copy",{duration:2e3}),t.preventDefault())}_onUpdateFound(t){const e=t.installing;t.installing.addEventListener("statechange",(async()=>{if(!this._reloading)if("activated"!==e.state||navigator.serviceWorker.controller){if("activated"===e.state&&navigator.serviceWorker.controller){if(!this._userHasInteracted)return this._reloading=!0,void location.reload();const t=this._toastsUi.show("Update available",{buttons:["reload","dismiss"]});"reload"===await t.answer&&(this._reloading=!0,location.reload())}}else this._toastsUi.show("Ready to work offline",{duration:5e3})}))}_onSettingsChange(){const t=this._settingsUi.getSettings();this._saveSettings(t),this._compressSvg(t)}async _onSettingsReset(t){const e=this._toastsUi.show("Settings reset",{buttons:["undo","dismiss"],duration:5e3});"undo"===await e.answer&&(this._settingsUi.setSettings(t),this._onSettingsChange())}async _onInputChange({data:t,filename:e}){const s=this._settingsUi.getSettings();this._userHasInteracted=!0;try{this._inputItem=await W.wrapOriginal(t),this._inputFilename=e}catch(t){return this._mainMenuUi.stopSpinner(),void this._handleError(new Error(`Load failed: ${t.message}`))}this._cache.purge(),this._compressSvg(s),this._outputUi.reset(),this._mainUi.activate(),this._mainMenuUi.allowHide=!0,this._mainMenuUi.hide()}_handleError(t){this._toastsUi.show(t.message,{isError:!0}),console.error(t)}async _loadSettings(){const t=await h.get("settings");t&&this._settingsUi.setSettings(t)}_saveSettings(t){const{original:e,...s}=t;h.set("settings",s)}async _compressSvg(t){const e=this._latestCompressJobId=Math.random();if(await W.abort(),e!==this._latestCompressJobId)return;if(t.original)return void this._updateForFile(this._inputItem,{compress:t.gzip});const s=this._cache.match(t.fingerprint);if(s)this._updateForFile(s,{compareToFile:this._inputItem,compress:t.gzip});else{this._downloadButtonUi.working();try{const e=await W.process(this._inputItem.text,t);this._updateForFile(e,{compareToFile:this._inputItem,compress:t.gzip}),this._cache.add(t.fingerprint,e)}catch(t){if("AbortError"===t.name)return;t.message=`Minifying error: ${t.message}`,this._handleError(t)}finally{this._downloadButtonUi.done()}}}async _updateForFile(t,{compareToFile:e,compress:s}){this._outputUi.update(t),this._downloadButtonUi.setDownload(this._inputFilename,t),this._copyButtonUi.setCopyText(t.text),this._resultsUi.update({comparisonSize:e&&await e.size({compress:s}),size:await t.size({compress:s})})}}}();
//# sourceMappingURL=page.js.map
