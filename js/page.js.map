{"version":3,"file":"page.js","sources":["../../src/js/page/utils.js","../../src/js/utils/storage.js","../../src/js/page/worker-messenger.js","../../src/js/page/gzip.js","../../src/js/page/svg-file.js","../../src/js/page/ui/pan-zoom.js","../../src/js/page/ui/svg-output.js","../../src/js/page/ui/code-output.js","../../src/js/page/prism.js","../../src/js/page/ui/output.js","../../src/js/page/ui/ripple.js","../../src/js/page/ui/floating-action-button.js","../../src/js/page/ui/spinner.js","../../src/js/page/ui/download-button.js","../../src/js/page/ui/copy-button.js","../../src/js/page/ui/bg-fill-button.js","../../src/js/page/ui/results.js","../../node_modules/.pnpm/nanoevents@6.0.1/node_modules/nanoevents/index.js","../../src/js/page/ui/material-slider.js","../../src/js/page/ui/settings.js","../../src/js/page/ui/main-menu.js","../../src/js/page/ui/toasts.js","../../src/js/page/ui/file-drop.js","../../src/js/page/ui/preloader.js","../../src/js/page/ui/changelog.js","../../src/js/page/ui/results-container.js","../../src/js/page/ui/view-toggler.js","../../src/js/page/results-cache.js","../../src/js/page/ui/main-ui.js","../../src/js/page/main-controller.js","../../src/js/page/svgo.js","../../src/js/page/index.js"],"sourcesContent":["export const domReady = new Promise((resolve) => {\n  function checkState() {\n    if (document.readyState !== 'loading') resolve();\n  }\n\n  document.addEventListener('readystatechange', checkState);\n  checkState();\n});\n\nconst range = document.createRange();\nrange.selectNode(document.documentElement);\n\nexport function strToEl(str) {\n  return range.createContextualFragment(String(str)).children[0];\n}\n\nconst entityMap = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '&quot;',\n  \"'\": '&#39;',\n  '/': '&#x2F;',\n};\n\nexport function escapeHTML(str) {\n  return String(str).replace(/[&<>\"'/]/g, (s) => entityMap[s]);\n}\n\nexport function escapeHtmlTag(strings, ...values) {\n  values = values.map((s) => escapeHTML(s));\n  return strings.reduce((str, val, i) => str + val + (values[i] || ''), '');\n}\n\nexport function readFileAsText(file) {\n  return new Response(file).text();\n}\n\nfunction transitionClassFunc({ removeClass = false } = {}) {\n  return (element, className = 'active', transitionClass = 'transition') => {\n    const hasClass = element.classList.contains(className);\n\n    if (removeClass) {\n      if (!hasClass) return Promise.resolve();\n    } else if (hasClass) {\n      return Promise.resolve();\n    }\n\n    const transitionEnd = new Promise((resolve) => {\n      const listener = (event) => {\n        if (event.target !== element) return;\n        element.removeEventListener('transitionend', listener);\n        element.classList.remove(transitionClass);\n        resolve();\n      };\n\n      element.classList.add(transitionClass);\n\n      requestAnimationFrame(() => {\n        element.addEventListener('transitionend', listener);\n        element.classList[removeClass ? 'remove' : 'add'](className);\n      });\n    });\n\n    const transitionTimeout = new Promise((resolve) => {\n      setTimeout(resolve, 1000);\n    });\n\n    return Promise.race([transitionEnd, transitionTimeout]);\n  };\n}\n\nexport const transitionToClass = transitionClassFunc();\nexport const transitionFromClass = transitionClassFunc({ removeClass: true });\n\nexport function trackFocusMethod() {\n  let focusMethod = 'mouse';\n\n  document.body.addEventListener(\n    'focus',\n    (event) => {\n      event.target.classList.add(\n        focusMethod === 'key' ? 'key-focused' : 'mouse-focused',\n      );\n    },\n    true,\n  );\n\n  document.body.addEventListener(\n    'blur',\n    (event) => {\n      event.target.classList.remove('key-focused', 'mouse-focused');\n    },\n    true,\n  );\n\n  document.body.addEventListener(\n    'keydown',\n    () => {\n      focusMethod = 'key';\n    },\n    true,\n  );\n\n  document.body.addEventListener(\n    'mousedown',\n    () => {\n      focusMethod = 'mouse';\n    },\n    true,\n  );\n}\n","export const idbKeyval = (() => {\n  let dbInstance;\n\n  function getDB() {\n    if (dbInstance) return dbInstance;\n\n    dbInstance = new Promise((resolve, reject) => {\n      const openreq = indexedDB.open('svgo-keyval', 1);\n\n      openreq.onerror = () => {\n        reject(openreq.error);\n      };\n\n      openreq.onupgradeneeded = () => {\n        // First time setup: create an empty object store\n        openreq.result.createObjectStore('keyval');\n      };\n\n      openreq.onsuccess = () => {\n        resolve(openreq.result);\n      };\n    });\n\n    return dbInstance;\n  }\n\n  async function withStore(type, callback) {\n    const db = await getDB();\n    return new Promise((resolve, reject) => {\n      const transaction = db.transaction('keyval', type);\n      transaction.oncomplete = () => resolve();\n      transaction.onerror = () => reject(transaction.error);\n      callback(transaction.objectStore('keyval'));\n    });\n  }\n\n  return {\n    async get(key) {\n      let request;\n      await withStore('readonly', (store) => {\n        request = store.get(key);\n      });\n      return request.result;\n    },\n    set(key, value) {\n      return withStore('readwrite', (store) => {\n        store.put(value, key);\n      });\n    },\n    delete(key) {\n      return withStore('readwrite', (store) => {\n        store.delete(key);\n      });\n    },\n  };\n})();\n","export default class WorkerMessenger {\n  constructor(url) {\n    this._requestId = 0;\n    // worker jobs awaiting response { [requestId]: [ resolve, reject ] }\n    this._pending = {};\n    this._url = url;\n    this._worker = null;\n  }\n\n  release() {\n    this._abortPending();\n    if (this._worker) {\n      this._worker.terminate();\n      this._worker = null;\n    }\n  }\n\n  requestResponse(message) {\n    return new Promise((resolve, reject) => {\n      message.id = ++this._requestId;\n      this._pending[message.id] = [resolve, reject];\n\n      if (!this._worker) this._startWorker();\n      this._worker.postMessage(message);\n    });\n  }\n\n  abort() {\n    if (Object.keys(this._pending).length === 0) return;\n\n    this._abortPending();\n    if (this._worker) this._worker.terminate();\n    this._startWorker();\n  }\n\n  _abortPending() {\n    for (const key of Object.keys(this._pending)) {\n      this._fulfillPending(\n        key,\n        null,\n        new DOMException('AbortError', 'AbortError'),\n      );\n    }\n  }\n\n  _startWorker() {\n    this._worker = new Worker(this._url);\n    this._worker.onmessage = (event) => this._onMessage(event);\n  }\n\n  _onMessage(event) {\n    if (!event.data.id) {\n      console.log('Unexpected message', event);\n      return;\n    }\n\n    this._fulfillPending(\n      event.data.id,\n      event.data.result,\n      event.data.error && new Error(event.data.error),\n    );\n  }\n\n  _fulfillPending(id, result, error) {\n    const resolver = this._pending[id];\n\n    if (!resolver) {\n      console.log('No resolver for', { id, result, error });\n      return;\n    }\n\n    delete this._pending[id];\n\n    if (error) {\n      resolver[1](error);\n      return;\n    }\n\n    resolver[0](result);\n  }\n}\n","import WorkerMessenger from './worker-messenger.js';\n\nclass Gzip extends WorkerMessenger {\n  constructor() {\n    super('js/gzip-worker.js');\n  }\n\n  compress(data) {\n    return this.requestResponse({ data });\n  }\n}\n\nexport const gzip = new Gzip();\n","import { gzip } from './gzip.js';\n\nexport default class SvgFile {\n  constructor(text, width, height) {\n    this.text = text;\n    this._compressedSize = null;\n    this._url = null;\n    this.width = width;\n    this.height = height;\n  }\n\n  async size({ compress }) {\n    if (!compress) return this.text.length;\n\n    if (!this._compressedSize) {\n      this._compressedSize = gzip\n        .compress(this.text)\n        .then((response) => response.byteLength);\n    }\n\n    return this._compressedSize;\n  }\n\n  get url() {\n    if (!this._url) {\n      this._url = URL.createObjectURL(\n        new Blob([this.text], { type: 'image/svg+xml' }),\n      );\n    }\n\n    return this._url;\n  }\n\n  release() {\n    if (!this._url) return;\n\n    URL.revokeObjectURL(this._url);\n  }\n}\n","function getXY(obj) {\n  return {\n    x: obj.pageX,\n    y: obj.pageY,\n  };\n}\n\nfunction touchDistance(touch1, touch2) {\n  const dx = Math.abs(touch2.x - touch1.x);\n  const dy = Math.abs(touch2.y - touch1.y);\n  return Math.hypot(dx, dy);\n}\n\nfunction getMidpoint(point1, point2) {\n  return {\n    x: (point1.x + point2.x) / 2,\n    y: (point1.y + point2.y) / 2,\n  };\n}\n\nfunction getPoints(event) {\n  return event.touches\n    ? [...event.touches].map((touch) => getXY(touch))\n    : [getXY(event)];\n}\n\nexport default class PanZoom {\n  constructor(\n    target,\n    { eventArea = target, shouldCaptureFunc = () => true } = {},\n  ) {\n    this._target = target;\n    this._shouldCaptureFunc = shouldCaptureFunc;\n    this._dx = 0;\n    this._dy = 0;\n    this._scale = 1;\n    this._active = 0;\n    this._lastPoints = [];\n\n    // TODO: revisit this later\n    // Ideally these would use public class fields, but around 1.7% of users\n    // are on old Safari versions that don't support them. We should be able\n    // to switch over soon.\n    this._onPointerDown = (event) => {\n      if (event.type === 'mousedown' && event.button !== 0) return;\n      if (!this._shouldCaptureFunc(event.target)) return;\n      event.preventDefault();\n\n      this._lastPoints = getPoints(event);\n      this._active++;\n\n      if (this._active === 1) this._onFirstPointerDown();\n    };\n\n    this._onPointerMove = (event) => {\n      event.preventDefault();\n      const points = getPoints(event);\n      /* eslint-disable unicorn/no-array-reduce, unicorn/no-array-callback-reference */\n      const averagePoint = points.reduce(getMidpoint);\n      const averageLastPoint = this._lastPoints.reduce(getMidpoint);\n      /* eslint-enable unicorn/no-array-reduce, unicorn/no-array-callback-reference */\n      const { left, top } = this._target.getBoundingClientRect();\n\n      this._dx += averagePoint.x - averageLastPoint.x;\n      this._dy += averagePoint.y - averageLastPoint.y;\n\n      if (points[1]) {\n        const scaleDiff =\n          touchDistance(points[0], points[1]) /\n          touchDistance(this._lastPoints[0], this._lastPoints[1]);\n        this._scale *= scaleDiff;\n        this._dx -= (averagePoint.x - left) * (scaleDiff - 1);\n        this._dy -= (averagePoint.y - top) * (scaleDiff - 1);\n      }\n\n      this._update();\n      this._lastPoints = points;\n    };\n\n    this._onPointerUp = (event) => {\n      event.preventDefault();\n      this._active--;\n      this._lastPoints.pop();\n\n      if (this._active) {\n        this._lastPoints = getPoints(event);\n        return;\n      }\n\n      document.removeEventListener('mousemove', this._onPointerMove);\n      document.removeEventListener('mouseup', this._onPointerUp);\n      document.removeEventListener('touchmove', this._onPointerMove);\n      document.removeEventListener('touchend', this._onPointerUp);\n    };\n\n    // bound events\n    eventArea.addEventListener('mousedown', this._onPointerDown);\n    eventArea.addEventListener('touchstart', this._onPointerDown);\n\n    // unbound\n    eventArea.addEventListener('wheel', (event) => this._onWheel(event));\n  }\n\n  reset() {\n    this._dx = 0;\n    this._dy = 0;\n    this._scale = 1;\n    this._update();\n  }\n\n  _onWheel(event) {\n    if (!this._shouldCaptureFunc(event.target)) return;\n    event.preventDefault();\n\n    const { left, top } = this._target.getBoundingClientRect();\n    let delta = event.deltaY;\n\n    // 1 is \"lines\", 0 is \"pixels\"\n    // Firefox uses \"lines\" when mouse is connected\n    if (event.deltaMode === 1) {\n      delta *= 15;\n    }\n\n    // stop mouse wheel producing huge values\n    delta = Math.max(Math.min(delta, 60), -60);\n\n    const scaleDiff = delta / 300 + 1;\n\n    // avoid to-small values\n    if (this._scale * scaleDiff < 0.05) return;\n\n    this._scale *= scaleDiff;\n    this._dx -= (event.pageX - left) * (scaleDiff - 1);\n    this._dy -= (event.pageY - top) * (scaleDiff - 1);\n    this._update();\n  }\n\n  _onFirstPointerDown() {\n    document.addEventListener('mousemove', this._onPointerMove);\n    document.addEventListener('mouseup', this._onPointerUp);\n    document.addEventListener('touchmove', this._onPointerMove);\n    document.addEventListener('touchend', this._onPointerUp);\n  }\n\n  _update() {\n    this._target.style.transform = `translate3d(${this._dx}px, ${this._dy}px, 0) scale(${this._scale})`;\n  }\n}\n","import { domReady, strToEl } from '../utils.js';\nimport PanZoom from './pan-zoom.js';\n\nexport default class SvgOutput {\n  constructor() {\n    // prettier-ignore\n    this.container = strToEl(\n      '<div class=\"svg-output\">' +\n        '<div class=\"svg-container\">' +\n          '<iframe class=\"svg-frame\" sandbox=\"allow-scripts\" scrolling=\"no\" title=\"Loaded SVG file\"></iframe>' +\n        '</div>' +\n      '</div>'\n    );\n\n    this._svgFrame = this.container.querySelector('.svg-frame');\n    this._svgContainer = this.container.querySelector('.svg-container');\n\n    domReady.then(() => {\n      this._panZoom = new PanZoom(this._svgContainer, {\n        eventArea: this.container,\n      });\n    });\n  }\n\n  setSvg({ text, width, height }) {\n    // TODO: revisit this\n    // I would rather use blob urls, but they don't work in Firefox\n    // All the internal refs break.\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=1125667\n    const nextLoad = this._nextLoadPromise();\n    this._svgFrame.src = `data:image/svg+xml,${encodeURIComponent(text)}`;\n    this._svgFrame.style.width = `${width}px`;\n    this._svgFrame.style.height = `${height}px`;\n    return nextLoad;\n  }\n\n  reset() {\n    this._svgFrame.src = 'about:blank';\n    this._panZoom.reset();\n  }\n\n  _nextLoadPromise() {\n    return new Promise((resolve) => {\n      const onload = () => {\n        this._svgFrame.removeEventListener('load', onload);\n        resolve();\n      };\n\n      this._svgFrame.addEventListener('load', onload);\n    });\n  }\n}\n","import { strToEl } from '../utils.js';\nimport Prism from '../prism.js';\n\nconst prism = new Prism();\n\nexport default class CodeOutput {\n  constructor() {\n    // prettier-ignore\n    this.container = strToEl(\n      '<div class=\"code-output\">' +\n        '<pre><code></code></pre>' +\n      '</div>'\n    );\n    this._codeEl = this.container.querySelector('code');\n  }\n\n  async setSvg({ text }) {\n    this._codeEl.innerHTML = await prism.highlight(text);\n  }\n\n  reset() {\n    this._codeEl.innerHTML = '';\n  }\n}\n","import WorkerMessenger from './worker-messenger.js';\n\nexport default class Prism extends WorkerMessenger {\n  constructor() {\n    super('js/prism-worker.js');\n  }\n\n  highlight(data) {\n    return this.requestResponse({ data });\n  }\n}\n","import { strToEl, transitionToClass, transitionFromClass } from '../utils.js';\nimport SvgOutput from './svg-output.js';\nimport CodeOutput from './code-output.js';\n\nexport default class Output {\n  constructor() {\n    this.container = strToEl('<div class=\"output-switcher\"></div>');\n\n    this._types = {\n      image: new SvgOutput(),\n      code: new CodeOutput(),\n    };\n\n    this._svgFile = null;\n    this._switchQueue = Promise.resolve();\n    this.set('image', { noAnimate: true });\n  }\n\n  update(svgFile) {\n    this._svgFile = svgFile;\n    return this._types[this._activeType].setSvg(svgFile);\n  }\n\n  reset() {\n    this._types[this._activeType].reset();\n  }\n\n  set(type, { noAnimate = false } = {}) {\n    this._switchQueue = this._switchQueue.then(async () => {\n      const toRemove =\n        this._activeType && this._types[this._activeType].container;\n\n      this._activeType = type;\n      const toAdd = this._types[this._activeType].container;\n      this.container.append(toAdd);\n\n      if (this._svgFile) await this.update(this._svgFile);\n\n      if (noAnimate) {\n        toAdd.classList.add('active');\n        if (toRemove) toRemove.classList.remove('active');\n      } else {\n        const transitions = [transitionToClass(toAdd)];\n\n        if (toRemove) transitions.push(transitionFromClass(toRemove));\n\n        await Promise.all(transitions);\n      }\n\n      if (toRemove) toRemove.remove();\n    });\n\n    return this._switchQueue;\n  }\n}\n","import { strToEl } from '../utils.js';\n\nexport default class Ripple {\n  constructor() {\n    this.container = strToEl('<span class=\"ripple\"></span>');\n  }\n\n  animate() {\n    this.container.classList.remove('animate');\n    this.container.offsetLeft; // eslint-disable-line no-unused-expressions\n    this.container.classList.add('animate');\n  }\n}\n","import { strToEl } from '../utils.js';\nimport Ripple from './ripple.js';\n\nexport default class FloatingActionButton {\n  constructor({ title, href, iconSvg, major = false }) {\n    // prettier-ignore\n    this.container = strToEl(\n      (href ? '<a>' : '<div role=\"button\" tabindex=\"0\">') +\n        iconSvg +\n      (href ? '</a>' : '</div>')\n    );\n\n    const classes = ['floating-action-button'];\n\n    if (href) this.container.href = href;\n    if (title) this.container.setAttribute('title', title);\n    if (major) classes.push('major-floating-action-button');\n\n    this.container.classList.add(...classes);\n\n    this._ripple = new Ripple();\n    this.container.append(this._ripple.container);\n    this.container.addEventListener('click', () => this.onClick());\n  }\n\n  onClick() {\n    this._ripple.animate();\n  }\n}\n","import { strToEl } from '../utils.js';\n\nexport default class Spinner {\n  constructor() {\n    // prettier-ignore\n    this.container = strToEl(\n      '<div class=\"spinner\">' +\n        '<div class=\"spinner-container\">' +\n          '<div class=\"spinner-layer\">' +\n            '<div class=\"circle-clipper left\">' +\n              '<div class=\"circle\"></div>' +\n            '</div>' +\n            '<div class=\"gap-patch\">' +\n              '<div class=\"circle\"></div>' +\n            '</div>' +\n            '<div class=\"circle-clipper right\">' +\n              '<div class=\"circle\"></div>' +\n            '</div>' +\n          '</div>' +\n        '</div>' +\n      '</div>'\n    );\n\n    this._showTimeout = null;\n    this.container.style.display = 'none';\n\n    this.container.addEventListener('animationend', (event) => {\n      if (event.target === this.container) {\n        this.container.style.display = 'none';\n      }\n    });\n  }\n\n  show(delay = 300) {\n    clearTimeout(this._showTimeout);\n    this.container.style.display = 'none';\n    this.container.classList.remove('cooldown');\n    this._showTimeout = setTimeout(() => {\n      this.container.style.display = '';\n    }, delay);\n  }\n\n  hide() {\n    clearTimeout(this._showTimeout);\n    this.container.classList.add('cooldown');\n  }\n}\n","import FloatingActionButton from './floating-action-button.js';\nimport Spinner from './spinner.js';\n\nexport default class DownloadButton extends FloatingActionButton {\n  constructor() {\n    const title = 'Download';\n\n    super({\n      title,\n      href: './',\n      iconSvg:\n        // prettier-ignore\n        '<svg aria-hidden=\"true\" class=\"icon\" viewBox=\"0 0 24 24\">' +\n          '<path d=\"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z\"/>' +\n        '</svg>',\n      major: true,\n    });\n\n    this._spinner = new Spinner();\n    this.container.append(this._spinner.container);\n  }\n\n  setDownload(filename, { url }) {\n    this.container.download = filename;\n    this.container.href = url;\n  }\n\n  working() {\n    this._spinner.show(500);\n  }\n\n  done() {\n    this._spinner.hide();\n  }\n}\n","import FloatingActionButton from './floating-action-button.js';\n\nexport default class CopyButton extends FloatingActionButton {\n  constructor() {\n    const title = 'Copy as text';\n\n    super({\n      title,\n      iconSvg:\n        // prettier-ignore\n        '<svg aria-hidden=\"true\" class=\"icon\" viewBox=\"0 0 24 24\">' +\n          '<path d=\"M16 1H4C3 1 2 2 2 3v14h2V3h12V1zm3 4H8C7 5 6 6 6 7v14c0 1 1 2 2 2h11c1 0 2-1 2-2V7c0-1-1-2-2-2zm0 16H8V7h11v14z\"/>' +\n        '</svg>',\n    });\n\n    this._text = null;\n    this._pre = document.createElement('pre');\n  }\n\n  onClick(event) {\n    super.onClick(event);\n    this.copyText();\n  }\n\n  copyText() {\n    if (!this._text) return false;\n\n    this._pre.textContent = this._text;\n    document.body.append(this._pre);\n    getSelection().removeAllRanges();\n\n    const range = document.createRange();\n    range.selectNode(this._pre);\n\n    window.getSelection().addRange(range);\n\n    document.execCommand('copy');\n    getSelection().removeAllRanges();\n    this._pre.remove();\n\n    return true;\n  }\n\n  setCopyText(text) {\n    this._text = text;\n  }\n}\n","import FloatingActionButton from './floating-action-button.js';\n\nexport default class BgFillButton extends FloatingActionButton {\n  constructor() {\n    const title = 'Preview on vivid background';\n\n    super({\n      title,\n      iconSvg:\n        // prettier-ignore\n        '<svg aria-hidden=\"true\" class=\"icon\" viewBox=\"0 0 24 24\">' +\n          '<path fill=\"currentColor\" d=\"M21.143 9.667c-.733-1.392-1.914-3.05-3.617-4.753C14.549 1.936 12.048 1 10.741 1c-.414 0-.708.094-.86.246L8.52 2.606c-1.899-.236-3.42.106-4.294.983-.876.875-1.164 2.159-.792 3.523.492 1.806 2.305 4.049 5.905 5.375.038.323.157.638.405.885.588.588 1.535.586 2.121 0s.588-1.533.002-2.119a1.5 1.5 0 0 0-2.123-.001l-.17.256c-2.031-.765-3.395-1.828-4.232-2.9l3.879-3.875c.496 2.73 6.432 8.676 9.178 9.178l-7.115 7.107c-.234.153-2.798-.316-6.156-3.675-3.393-3.393-3.175-5.271-3.027-5.498L3.96 9.989C3.521 9.63 3.035 8.886 2.819 8.3L.685 10.431C.24 10.877 0 11.495 0 12.251c0 1.634 1.121 3.915 3.713 6.506C6.477 21.521 9.293 23 11.145 23c.648 0 1.18-.195 1.547-.562l8.086-8.078c.91.874-.778 3.538-.778 4.648a2 2 0 0 0 4-.001c0-3.184-1.425-6.81-2.857-9.34zM4.934 4.296c.527-.53 1.471-.791 2.656-.761L4.381 6.741c-.236-.978-.049-1.845.553-2.445zm9.292 4.079-.03-.029C12.904 7.054 10.393 3.99 11.1 3.283c.715-.715 3.488 1.521 5.062 3.096.862.862 2.088 2.247 2.937 3.458-1.717-1.074-3.491-1.469-4.873-1.462z\"/>' +\n        '</svg>',\n    });\n  }\n\n  onClick(event) {\n    super.onClick(event);\n    // event adds a background color\n    if (this.container.classList.contains('active')) {\n      this.container.classList.remove('active');\n      this.setColor('transparent');\n    } else {\n      this.container.classList.add('active');\n      this.setColor('rgba(0, 0, 0, 0.7)');\n    }\n  }\n\n  setColor(color) {\n    document.documentElement.style.backgroundColor = color;\n  }\n}\n","import { strToEl } from '../utils.js';\n\nfunction round(num, places) {\n  const mult = 10 ** places;\n  return Math.floor(Math.round(num * mult)) / mult;\n}\n\nfunction humanSize(bytes) {\n  return bytes < 1024 ? `${bytes} bytes` : `${round(bytes / 1024, 2)}k`;\n}\n\nexport default class Results {\n  constructor() {\n    // prettier-ignore\n    this.container = strToEl(\n      '<div class=\"results\">' +\n        '<span class=\"size\"></span> ' +\n        '<span class=\"diff\"></span>' +\n      '</div>'\n    );\n\n    this._sizeEl = this.container.querySelector('.size');\n    this._diffEl = this.container.querySelector('.diff');\n  }\n\n  update({ size, comparisonSize }) {\n    this._sizeEl.textContent = comparisonSize\n      ? `${humanSize(comparisonSize)} → ${humanSize(size)}`\n      : humanSize(size);\n\n    this._diffEl.classList.remove('decrease', 'increase');\n\n    // just displaying a single size?\n    if (!comparisonSize) {\n      this._diffEl.textContent = '';\n    } else if (size === comparisonSize) {\n      this._diffEl.textContent = '100%';\n    } else {\n      this._diffEl.textContent = `${round((size / comparisonSize) * 100, 2)}%`;\n      this._diffEl.classList.add(\n        size > comparisonSize ? 'increase' : 'decrease',\n      );\n    }\n  }\n}\n","export let createNanoEvents = () => ({\n  events: {},\n  emit(event, ...args) {\n    ;(this.events[event] || []).forEach(i => i(...args))\n  },\n  on(event, cb) {\n    ;(this.events[event] = this.events[event] || []).push(cb)\n    return () =>\n      (this.events[event] = (this.events[event] || []).filter(i => i !== cb))\n  }\n})\n","import { strToEl } from '../utils.js';\n\nexport default class MaterialSlider {\n  constructor(rangeElement) {\n    // prettier-ignore\n    this.container = strToEl(\n      '<div class=\"material-slider\">' +\n        '<div class=\"track\">' +\n          '<div class=\"track-on\"></div>' +\n          '<div class=\"handle\">' +\n            '<div class=\"arrow\"></div>' +\n            '<div class=\"val\"></div>' +\n          '</div>' +\n        '</div>' +\n      '</div>'\n    );\n\n    this._range = rangeElement;\n    this._handle = this.container.querySelector('.handle');\n    this._trackOn = this.container.querySelector('.track-on');\n    this._val = this.container.querySelector('.val');\n\n    this._range.parentNode.insertBefore(this.container, this._range);\n    this.container.insertBefore(this._range, this.container.firstChild);\n\n    this._range.addEventListener('input', () => this._onInputChange());\n    this._range.addEventListener('mousedown', () => this._onRangeMouseDown());\n    this._range.addEventListener('touchstart', () => this._onRangeTouchStart());\n    this._range.addEventListener('touchend', () => this._onRangeTouchEnd());\n\n    this._setPosition();\n  }\n\n  // eslint-disable-next-line accessor-pairs\n  set value(newValue) {\n    this._range.value = newValue;\n    this._update();\n  }\n\n  _onRangeTouchStart() {\n    this._range.focus();\n  }\n\n  _onRangeTouchEnd() {\n    this._range.blur();\n  }\n\n  _onRangeMouseDown() {\n    this._range.classList.add('active');\n\n    const upListener = () => {\n      requestAnimationFrame(() => {\n        this._range.blur();\n      });\n      this._range.classList.remove('active');\n      document.removeEventListener('mouseup', upListener);\n    };\n\n    document.addEventListener('mouseup', upListener);\n  }\n\n  _onInputChange() {\n    this._update();\n  }\n\n  _update() {\n    requestAnimationFrame(() => this._setPosition());\n  }\n\n  _setPosition() {\n    const { min, max, value } = this._range;\n    const percent = (Number(value) - min) / (max - min);\n\n    this._trackOn.style.width = this._handle.style.left = `${percent * 100}%`;\n    this._val.textContent = value;\n  }\n}\n","import { createNanoEvents } from 'nanoevents';\nimport { domReady } from '../utils.js';\nimport MaterialSlider from './material-slider.js';\nimport Ripple from './ripple.js';\n\nexport default class Settings {\n  constructor() {\n    this.emitter = createNanoEvents();\n    this._throttleTimeout = null;\n\n    domReady.then(() => {\n      this.container = document.querySelector('.settings');\n      this._pluginInputs = [\n        ...this.container.querySelectorAll('.plugins input'),\n      ];\n      this._globalInputs = [\n        ...this.container.querySelectorAll('.global input'),\n      ];\n\n      const scroller = this.container.querySelector('.settings-scroller');\n      const resetBtn = this.container.querySelector('.setting-reset');\n      const ranges = this.container.querySelectorAll('input[type=range]');\n\n      this._resetRipple = new Ripple();\n      resetBtn.append(this._resetRipple.container);\n\n      // map real range elements to Slider instances\n      this._sliderMap = new WeakMap();\n\n      // enhance ranges\n      for (const range of ranges) {\n        this._sliderMap.set(range, new MaterialSlider(range));\n      }\n\n      this.container.addEventListener('input', (event) =>\n        this._onChange(event),\n      );\n      resetBtn.addEventListener('click', () => this._onReset());\n\n      // TODO: revisit this\n      // Stop double-tap text selection.\n      // This stops all text selection which is kinda sad.\n      // I think this code will bite me.\n      scroller.addEventListener('mousedown', (event) => {\n        if (event.target.closest('input[type=range]')) return;\n        event.preventDefault();\n      });\n    });\n  }\n\n  _onChange(event) {\n    clearTimeout(this._throttleTimeout);\n\n    // throttle range\n    if (event.target.type === 'range') {\n      this._throttleTimeout = setTimeout(\n        () => this.emitter.emit('change'),\n        150,\n      );\n    } else {\n      this.emitter.emit('change');\n    }\n  }\n\n  _onReset() {\n    this._resetRipple.animate();\n    const oldSettings = this.getSettings();\n\n    // Set all inputs according to their initial attributes\n    for (const inputEl of this._globalInputs) {\n      if (inputEl.type === 'checkbox') {\n        inputEl.checked = inputEl.hasAttribute('checked');\n      } else if (inputEl.type === 'range') {\n        this._sliderMap.get(inputEl).value = inputEl.getAttribute('value');\n      }\n    }\n\n    for (const inputEl of this._pluginInputs) {\n      inputEl.checked = inputEl.hasAttribute('checked');\n    }\n\n    this.emitter.emit('reset', oldSettings);\n    this.emitter.emit('change');\n  }\n\n  setSettings(settings) {\n    for (const inputEl of this._globalInputs) {\n      if (!(inputEl.name in settings)) continue;\n\n      if (inputEl.type === 'checkbox') {\n        inputEl.checked = settings[inputEl.name];\n      } else if (inputEl.type === 'range') {\n        this._sliderMap.get(inputEl).value = settings[inputEl.name];\n      }\n    }\n\n    for (const inputEl of this._pluginInputs) {\n      if (!(inputEl.name in settings.plugins)) continue;\n      inputEl.checked = settings.plugins[inputEl.name];\n    }\n  }\n\n  getSettings() {\n    // fingerprint is used for cache lookups\n    const fingerprint = [];\n    const output = {\n      plugins: {},\n    };\n\n    for (const inputEl of this._globalInputs) {\n      if (inputEl.name !== 'gzip' && inputEl.name !== 'original') {\n        if (inputEl.type === 'checkbox') {\n          fingerprint.push(Number(inputEl.checked));\n        } else {\n          fingerprint.push(`|${inputEl.value}|`);\n        }\n      }\n\n      output[inputEl.name] =\n        inputEl.type === 'checkbox' ? inputEl.checked : inputEl.value;\n    }\n\n    for (const inputEl of this._pluginInputs) {\n      fingerprint.push(Number(inputEl.checked));\n      output.plugins[inputEl.name] = inputEl.checked;\n    }\n\n    output.fingerprint = fingerprint.join(',');\n\n    return output;\n  }\n}\n","import { createNanoEvents } from 'nanoevents';\nimport {\n  domReady,\n  transitionFromClass,\n  transitionToClass,\n  readFileAsText,\n} from '../utils.js';\nimport Spinner from './spinner.js';\n\nexport default class MainMenu {\n  constructor() {\n    this.emitter = createNanoEvents();\n    this.allowHide = false;\n    this._spinner = new Spinner();\n\n    domReady.then(() => {\n      this.container = document.querySelector('.main-menu');\n      this._loadFileInput = this.container.querySelector('.load-file-input');\n      this._pasteInput = this.container.querySelector('.paste-input');\n      this._loadDemoBtn = this.container.querySelector('.load-demo');\n      this._loadFileBtn = this.container.querySelector('.load-file');\n      this._pasteLabel = this.container.querySelector('.menu-input');\n      this._overlay = this.container.querySelector('.overlay');\n      this._menu = this.container.querySelector('.menu');\n      const menuBtn = document.querySelector('.menu-btn');\n\n      menuBtn.addEventListener('click', (event) =>\n        this._onMenuButtonClick(event),\n      );\n      this._overlay.addEventListener('click', (event) =>\n        this._onOverlayClick(event),\n      );\n      this._loadFileBtn.addEventListener('click', (event) =>\n        this._onLoadFileClick(event),\n      );\n      this._loadDemoBtn.addEventListener('click', (event) =>\n        this._onLoadDemoClick(event),\n      );\n      this._loadFileInput.addEventListener('change', () =>\n        this._onFileInputChange(),\n      );\n      this._pasteInput.addEventListener('input', () =>\n        this._onTextInputChange(),\n      );\n    });\n  }\n\n  show() {\n    this.container.classList.remove('hidden');\n    transitionFromClass(this._overlay, 'hidden');\n    transitionFromClass(this._menu, 'hidden');\n  }\n\n  hide() {\n    if (!this.allowHide) return;\n    this.stopSpinner();\n    this.container.classList.add('hidden');\n    transitionToClass(this._overlay, 'hidden');\n    transitionToClass(this._menu, 'hidden');\n  }\n\n  stopSpinner() {\n    this._spinner.hide();\n  }\n\n  showFilePicker() {\n    this._loadFileInput.click();\n  }\n\n  setPasteInput(value) {\n    this._pasteInput.value = value;\n    this._pasteInput.dispatchEvent(new Event('input'));\n  }\n\n  _onOverlayClick(event) {\n    event.preventDefault();\n    this.hide();\n  }\n\n  _onMenuButtonClick(event) {\n    event.preventDefault();\n    this.show();\n  }\n\n  _onTextInputChange() {\n    const value = this._pasteInput.value;\n    if (!value.includes('</svg>')) return;\n\n    this._pasteInput.value = '';\n    this._pasteInput.blur();\n\n    this._pasteLabel.append(this._spinner.container);\n    this._spinner.show();\n\n    this.emitter.emit('svgDataLoad', {\n      data: value,\n      filename: 'image.svg',\n    });\n  }\n\n  _onLoadFileClick(event) {\n    event.preventDefault();\n    event.target.blur();\n    this.showFilePicker();\n  }\n\n  async _onFileInputChange() {\n    const file = this._loadFileInput.files[0];\n\n    if (!file) return;\n\n    this._loadFileBtn.append(this._spinner.container);\n    this._spinner.show();\n\n    this.emitter.emit('svgDataLoad', {\n      data: await readFileAsText(file),\n      filename: file.name,\n    });\n  }\n\n  async _onLoadDemoClick(event) {\n    event.preventDefault();\n    event.target.blur();\n    this._loadDemoBtn.append(this._spinner.container);\n    this._spinner.show();\n\n    try {\n      const data = await fetch('test-svgs/car-lite.svg').then((response) =>\n        response.text(),\n      );\n      this.emitter.emit('svgDataLoad', {\n        data,\n        filename: 'car-lite.svg',\n      });\n    } catch {\n      this.stopSpinner();\n\n      const error = new Error(\n        'serviceWorker' in navigator && navigator.serviceWorker.controller\n          ? 'Demo not available offline' // TODO: revisit this\n          : \"Couldn't fetch demo SVG\",\n      );\n\n      this.emitter.emit('error', { error });\n    }\n  }\n}\n","import { strToEl, transitionToClass } from '../utils.js';\n\nclass Toast {\n  constructor(message, duration, buttons, isError) {\n    this.container = strToEl(\n      '<div class=\"toast\"><div class=\"toast-content\"></div></div>',\n    );\n    const content = this.container.querySelector('.toast-content');\n    this._answerResolve = null;\n    this._hideTimeout = null;\n\n    if (isError) {\n      content.insertAdjacentHTML('afterbegin', '<pre><code></code></pre>');\n      content.querySelector('code').textContent = message;\n    } else {\n      content.textContent = message;\n    }\n\n    this.answer = new Promise((resolve) => {\n      this._answerResolve = resolve;\n    });\n\n    for (const button of buttons) {\n      const buttonElement = document.createElement('button');\n      buttonElement.className = 'unbutton';\n      buttonElement.textContent = button;\n      buttonElement.type = 'button';\n      buttonElement.addEventListener('click', () => {\n        this._answerResolve(button);\n      });\n      this.container.append(buttonElement);\n    }\n\n    if (duration) {\n      this._hideTimeout = setTimeout(() => this.hide(), duration);\n    }\n  }\n\n  hide() {\n    clearTimeout(this._hideTimeout);\n    this._answerResolve();\n    return transitionToClass(this.container, 'hide');\n  }\n}\n\nexport default class Toasts {\n  constructor() {\n    this.container = strToEl('<div class=\"toasts\"></div>');\n  }\n\n  show(message, { duration = 0, buttons = ['dismiss'], isError = false } = {}) {\n    const toast = new Toast(message, duration, buttons, isError);\n    this.container.append(toast.container);\n\n    toast.answer\n      .then(() => toast.hide())\n      .then(() => {\n        toast.container.remove();\n      });\n\n    return toast;\n  }\n}\n","import { createNanoEvents } from 'nanoevents';\nimport {\n  strToEl,\n  domReady,\n  transitionToClass,\n  transitionFromClass,\n  readFileAsText,\n} from '../utils.js';\n\nexport default class FileDrop {\n  constructor() {\n    this.emitter = createNanoEvents();\n    this.container = strToEl('<div class=\"drop-overlay\">Drop it!</div>');\n\n    // drag events are horrid\n    this._activeEnters = 0;\n    this._currentEnteredElement = null;\n\n    domReady.then(() => {\n      document.addEventListener('dragover', (event) => event.preventDefault());\n      document.addEventListener('dragenter', (event) =>\n        this._onDragEnter(event),\n      );\n      document.addEventListener('dragleave', () => this._onDragLeave());\n      document.addEventListener('drop', (event) => this._onDrop(event));\n    });\n  }\n\n  _onDragEnter(event) {\n    // TODO: revisit this\n    // Firefox double-fires on window enter, this works around it\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=1124645\n    if (this._currentEnteredElement === event.target) return;\n    this._currentEnteredElement = event.target;\n\n    if (!this._activeEnters++) {\n      transitionToClass(this.container);\n    }\n  }\n\n  _onDragLeave() {\n    this._currentEnteredElement = null;\n\n    if (!--this._activeEnters) {\n      transitionFromClass(this.container);\n    }\n  }\n\n  async _onDrop(event) {\n    event.preventDefault();\n\n    this._activeEnters = 0;\n    transitionFromClass(this.container);\n\n    const file = event.dataTransfer.files[0];\n    if (!file) return;\n\n    this.emitter.emit('svgDataLoad', {\n      data: await readFileAsText(file),\n      filename: file.name,\n    });\n  }\n}\n","import { domReady, transitionFromClass } from '../utils.js';\n\nexport default class Preloader {\n  constructor() {\n    domReady.then(() => {\n      this.container = document.querySelector('.preloader');\n      this.activated = this.container.classList.contains('active');\n      this.hide();\n    });\n  }\n\n  async hide() {\n    await transitionFromClass(this.container, 'active');\n    this.container.style.display = 'none';\n  }\n}\n","import {\n  strToEl,\n  escapeHtmlTag,\n  transitionToClass,\n  domReady,\n} from '../utils.js';\n\nexport default class Changelog {\n  constructor(loadedVersion) {\n    this.container = strToEl('<section class=\"changelog\"></section>');\n    this._loadedVersion = loadedVersion;\n  }\n\n  async showLogFrom(lastLoadedVersion) {\n    if (lastLoadedVersion === this._loadedVersion) return;\n    const changelog = await fetch('changelog.json').then((response) =>\n      response.json(),\n    );\n    let startIndex = 0;\n    let endIndex = 0;\n\n    for (const [i, entry] of Object.entries(changelog)) {\n      if (entry.version === this._loadedVersion) {\n        startIndex = i;\n      } else if (entry.version === lastLoadedVersion) {\n        break;\n      }\n\n      endIndex = i + 1;\n    }\n\n    const changeList = changelog\n      .slice(startIndex, endIndex)\n      // TODO: remove `reduce`\n      // eslint-disable-next-line unicorn/no-array-reduce\n      .reduce((array, entry) => array.concat(entry.changes), [])\n      .map((change) => escapeHtmlTag`<li>${change}</li>`);\n\n    this.container.append(\n      strToEl('<h1>Updated!</h1>'),\n      strToEl(`<ul>${changeList.join('')}</ul>`),\n    );\n\n    await domReady;\n    transitionToClass(this.container);\n  }\n}\n","import { domReady } from '../utils.js';\n\nexport default class ResultsContainer {\n  constructor(results) {\n    this._results = results;\n\n    domReady.then(() => {\n      this._container = document.querySelector('.results-container');\n      this._mobileContainer = document.querySelector(\n        '.results-container-mobile',\n      );\n      this._query = matchMedia('(min-width: 640px)');\n\n      this._query.addListener(() => this._positionResults());\n      this._positionResults();\n    });\n  }\n\n  _positionResults() {\n    if (this._query.matches) {\n      this._container.append(this._results.container);\n    } else {\n      this._mobileContainer.append(this._results.container);\n    }\n  }\n}\n","import { createNanoEvents } from 'nanoevents';\nimport { domReady } from '../utils.js';\n\n/**\n * Tabs that toggle between showing the SVG image and XML markup.\n */\nexport default class ViewToggler {\n  constructor() {\n    this.emitter = createNanoEvents();\n    /** @type {HTMLFormElement | null} */\n    this.container = null;\n\n    domReady.then(() => {\n      this.container = document.querySelector('.view-toggler');\n\n      // stop browsers remembering previous form state\n      this.container.output[0].checked = true;\n\n      this.container.addEventListener('change', () => {\n        this.emitter.emit('change', {\n          value: this.container.output.value,\n        });\n      });\n    });\n  }\n}\n","// TODO: switch to Map/Set\n\nexport default class ResultsCache {\n  constructor(size) {\n    this._size = size;\n    this.purge();\n  }\n\n  purge() {\n    this._fingerprints = [];\n    this._items = [];\n    this._index = 0;\n  }\n\n  add(fingerprint, svgFile) {\n    const oldItem = this._items[this._index];\n\n    if (oldItem) {\n      // gc blob url\n      oldItem.release();\n    }\n\n    this._fingerprints[this._index] = fingerprint;\n    this._items[this._index] = svgFile;\n\n    this._index = (this._index + 1) % this._size;\n  }\n\n  match(fingerprint) {\n    return this._items[this._fingerprints.indexOf(fingerprint)];\n  }\n}\n","import { transitionToClass } from '../utils.js';\n\nexport default class MainUi {\n  constructor(...elements) {\n    this._activated = false;\n    this._toActivate = elements;\n  }\n\n  activate() {\n    if (this._activated) return;\n    this._activated = true;\n\n    return Promise.all(\n      this._toActivate.map((element) => transitionToClass(element)),\n    );\n  }\n}\n","import { idbKeyval as storage } from '../utils/storage.js';\nimport Svgo from './svgo.js';\nimport { domReady } from './utils.js';\nimport Output from './ui/output.js';\nimport DownloadButton from './ui/download-button.js';\nimport CopyButton from './ui/copy-button.js';\nimport BgFillButton from './ui/bg-fill-button.js';\nimport Results from './ui/results.js';\nimport Settings from './ui/settings.js';\nimport MainMenu from './ui/main-menu.js';\nimport Toasts from './ui/toasts.js';\nimport FileDrop from './ui/file-drop.js';\nimport Preloader from './ui/preloader.js';\nimport Changelog from './ui/changelog.js';\nimport ResultsContainer from './ui/results-container.js';\nimport ViewToggler from './ui/view-toggler.js';\nimport ResultsCache from './results-cache.js';\nimport MainUi from './ui/main-ui.js';\n\nconst svgo = new Svgo();\n\nexport default class MainController {\n  constructor() {\n    // ui components\n    this._mainUi = null;\n    this._outputUi = new Output();\n    this._downloadButtonUi = new DownloadButton();\n    this._copyButtonUi = new CopyButton();\n    this._resultsUi = new Results();\n    this._settingsUi = new Settings();\n    this._mainMenuUi = new MainMenu();\n    this._toastsUi = new Toasts();\n\n    const bgFillUi = new BgFillButton();\n    const dropUi = new FileDrop();\n    const preloaderUi = new Preloader();\n    const changelogUi = new Changelog(self.version);\n    // _resultsContainerUi is unused\n    this._resultsContainerUi = new ResultsContainer(this._resultsUi);\n    const viewTogglerUi = new ViewToggler();\n\n    // ui events\n    this._settingsUi.emitter.on('change', () => this._onSettingsChange());\n    this._settingsUi.emitter.on('reset', (oldSettings) =>\n      this._onSettingsReset(oldSettings),\n    );\n    this._mainMenuUi.emitter.on('svgDataLoad', (event) =>\n      this._onInputChange(event),\n    );\n    dropUi.emitter.on('svgDataLoad', (event) => this._onInputChange(event));\n    this._mainMenuUi.emitter.on('error', ({ error }) =>\n      this._handleError(error),\n    );\n    viewTogglerUi.emitter.on('change', (event) =>\n      this._outputUi.set(event.value),\n    );\n    window.addEventListener('keydown', (event) => this._onGlobalKeyDown(event));\n    window.addEventListener('paste', (event) => this._onGlobalPaste(event));\n    window.addEventListener('copy', (event) => this._onGlobalCopy(event));\n\n    // state\n    this._inputItem = null;\n    this._cache = new ResultsCache(10);\n    this._latestCompressJobId = 0;\n    this._userHasInteracted = false;\n    this._reloading = false;\n\n    if ('serviceWorker' in navigator) {\n      navigator.serviceWorker\n        .register('sw.js', { scope: './' })\n        .then((registration) => {\n          registration.addEventListener('updatefound', () =>\n            this._onUpdateFound(registration),\n          );\n        });\n    }\n\n    // tell the user about the latest update\n    storage.get('last-seen-version').then((lastSeenVersion) => {\n      if (lastSeenVersion) changelogUi.showLogFrom(lastSeenVersion);\n      storage.set('last-seen-version', self.version);\n    });\n\n    domReady.then(() => {\n      const container = document.querySelector('.app-output');\n      const actionContainer = container.querySelector(\n        '.action-button-container',\n      );\n      const minorActionContainer = container.querySelector(\n        '.minor-action-container',\n      );\n      const toolbarElement = container.querySelector('.toolbar');\n      const outputElement = container.querySelector('.output');\n      const menuExtraElement = container.querySelector('.menu-extra');\n\n      // elements for intro anim\n      this._mainUi = new MainUi(\n        toolbarElement,\n        actionContainer,\n        this._outputUi.container,\n        this._settingsUi.container,\n      );\n\n      minorActionContainer.append(\n        bgFillUi.container,\n        this._copyButtonUi.container,\n      );\n      actionContainer.append(this._downloadButtonUi.container);\n      outputElement.append(this._outputUi.container);\n      container.append(this._toastsUi.container, dropUi.container);\n      menuExtraElement.append(changelogUi.container);\n\n      // load previous settings\n      this._loadSettings();\n\n      // someone managed to hit the preloader, aww\n      if (preloaderUi.activated) {\n        this._toastsUi.show('Ready now!', { duration: 3000 });\n      }\n\n      // for testing\n      // eslint-disable-next-line no-constant-condition\n      if (false) {\n        (async () => {\n          const data = await fetch('test-svgs/car-lite.svg').then((response) =>\n            response.text(),\n          );\n          this._onInputChange({ data, filename: 'car-lite.svg' });\n        })();\n      }\n    });\n  }\n\n  _onGlobalKeyDown(event) {\n    if (event.key === 'o' && (event.ctrlKey || event.metaKey)) {\n      event.preventDefault();\n      this._mainMenuUi.showFilePicker();\n    }\n\n    if (event.key === 'Escape') this._mainMenuUi.hide();\n  }\n\n  _onGlobalPaste(event) {\n    const value = event.clipboardData.getData('text');\n    if (!value.includes('</svg>')) {\n      this._toastsUi.show('Pasted value not an SVG', { duration: 2000 });\n    } else {\n      this._mainMenuUi.setPasteInput(value);\n      event.preventDefault();\n    }\n  }\n\n  _onGlobalCopy(event) {\n    const selection = window.getSelection();\n    if (!selection.isCollapsed) return;\n\n    this._toastsUi.show(\n      this._copyButtonUi.copyText() ? 'Copy successful' : 'Nothing to copy',\n      { duration: 2000 },\n    );\n\n    event.preventDefault();\n  }\n\n  _onUpdateFound(registration) {\n    const newWorker = registration.installing;\n\n    registration.installing.addEventListener('statechange', async () => {\n      if (this._reloading) return;\n\n      // the very first activation!\n      // tell the user stuff works offline\n      if (\n        newWorker.state === 'activated' &&\n        !navigator.serviceWorker.controller\n      ) {\n        this._toastsUi.show('Ready to work offline', { duration: 5000 });\n        return;\n      }\n\n      if (\n        newWorker.state === 'activated' &&\n        navigator.serviceWorker.controller\n      ) {\n        // if the user hasn't interacted yet, do a sneaky reload\n        if (!this._userHasInteracted) {\n          this._reloading = true;\n          location.reload();\n          return;\n        }\n\n        // otherwise, show the user an alert\n        const toast = this._toastsUi.show('Update available', {\n          buttons: ['reload', 'dismiss'],\n        });\n        const answer = await toast.answer;\n\n        if (answer === 'reload') {\n          this._reloading = true;\n          location.reload();\n        }\n      }\n    });\n  }\n\n  _onSettingsChange() {\n    const settings = this._settingsUi.getSettings();\n    this._saveSettings(settings);\n    this._compressSvg(settings);\n  }\n\n  async _onSettingsReset(oldSettings) {\n    const toast = this._toastsUi.show('Settings reset', {\n      buttons: ['undo', 'dismiss'],\n      duration: 5000,\n    });\n    const answer = await toast.answer;\n\n    if (answer === 'undo') {\n      this._settingsUi.setSettings(oldSettings);\n      this._onSettingsChange();\n    }\n  }\n\n  async _onInputChange({ data, filename }) {\n    const settings = this._settingsUi.getSettings();\n    this._userHasInteracted = true;\n\n    try {\n      this._inputItem = await svgo.wrapOriginal(data);\n      this._inputFilename = filename;\n    } catch (error) {\n      this._mainMenuUi.stopSpinner();\n      this._handleError(new Error(`Load failed: ${error.message}`));\n      return;\n    }\n\n    this._cache.purge();\n\n    this._compressSvg(settings);\n    this._outputUi.reset();\n    this._mainUi.activate();\n    this._mainMenuUi.allowHide = true;\n    this._mainMenuUi.hide();\n  }\n\n  _handleError(error) {\n    this._toastsUi.show(error.message, { isError: true });\n    console.error(error);\n  }\n\n  async _loadSettings() {\n    const settings = await storage.get('settings');\n    if (settings) this._settingsUi.setSettings(settings);\n  }\n\n  _saveSettings(settings) {\n    // doesn't make sense to retain the \"show original\" option\n    const { original, ...settingsToKeep } = settings;\n    storage.set('settings', settingsToKeep);\n  }\n\n  async _compressSvg(settings) {\n    const thisJobId = (this._latestCompressJobId = Math.random());\n\n    await svgo.abort();\n\n    if (thisJobId !== this._latestCompressJobId) {\n      // while we've been waiting, there's been a newer call\n      // to _compressSvg, we don't need to do anything\n      return;\n    }\n\n    if (settings.original) {\n      this._updateForFile(this._inputItem, {\n        compress: settings.gzip,\n      });\n      return;\n    }\n\n    const cacheMatch = this._cache.match(settings.fingerprint);\n\n    if (cacheMatch) {\n      this._updateForFile(cacheMatch, {\n        compareToFile: this._inputItem,\n        compress: settings.gzip,\n      });\n      return;\n    }\n\n    this._downloadButtonUi.working();\n\n    try {\n      const resultFile = await svgo.process(this._inputItem.text, settings);\n\n      this._updateForFile(resultFile, {\n        compareToFile: this._inputItem,\n        compress: settings.gzip,\n      });\n\n      this._cache.add(settings.fingerprint, resultFile);\n    } catch (error) {\n      if (error.name === 'AbortError') return;\n      error.message = `Minifying error: ${error.message}`;\n      this._handleError(error);\n    } finally {\n      this._downloadButtonUi.done();\n    }\n  }\n\n  async _updateForFile(svgFile, { compareToFile, compress }) {\n    this._outputUi.update(svgFile);\n    this._downloadButtonUi.setDownload(this._inputFilename, svgFile);\n    this._copyButtonUi.setCopyText(svgFile.text);\n\n    this._resultsUi.update({\n      comparisonSize: compareToFile && (await compareToFile.size({ compress })),\n      size: await svgFile.size({ compress }),\n    });\n  }\n}\n","import WorkerMessenger from './worker-messenger.js';\nimport SvgFile from './svg-file.js';\n\nexport default class Svgo extends WorkerMessenger {\n  constructor() {\n    super('js/svgo-worker.js');\n    this._currentJob = Promise.resolve();\n  }\n\n  async wrapOriginal(svgText) {\n    const { width, height } = await this.requestResponse({\n      action: 'wrapOriginal',\n      data: svgText,\n    });\n\n    return new SvgFile(svgText, width, height);\n  }\n\n  process(svgText, settings) {\n    this.abort();\n\n    this._currentJob = this._currentJob\n      .catch(() => {})\n      .then(async () => {\n        const { data, dimensions } = await this.requestResponse({\n          action: 'process',\n          settings,\n          data: svgText,\n        });\n\n        // return final result\n        return new SvgFile(data, dimensions.width, dimensions.height);\n      });\n\n    return this._currentJob;\n  }\n}\n","import { trackFocusMethod } from './utils.js';\nimport MainController from './main-controller.js';\n\ntrackFocusMethod();\nnew MainController(); // eslint-disable-line no-new\n"],"names":["domReady","Promise","resolve","checkState","document","readyState","addEventListener","range","createRange","strToEl","str","createContextualFragment","String","children","selectNode","documentElement","entityMap","escapeHtmlTag","strings","values","map","s","replace","reduce","val","i","readFileAsText","file","Response","text","transitionClassFunc","removeClass","element","className","transitionClass","hasClass","classList","contains","transitionEnd","listener","event","target","removeEventListener","remove","add","requestAnimationFrame","transitionTimeout","setTimeout","race","transitionToClass","transitionFromClass","idbKeyval","dbInstance","async","withStore","type","callback","db","reject","openreq","indexedDB","open","onerror","error","onupgradeneeded","result","createObjectStore","onsuccess","transaction","oncomplete","objectStore","key","request","store","get","set","value","put","delete","WorkerMessenger","constructor","url","this","_requestId","_pending","_url","_worker","release","_abortPending","terminate","requestResponse","message","id","_startWorker","postMessage","abort","Object","keys","length","_fulfillPending","DOMException","Worker","onmessage","_onMessage","data","Error","console","log","resolver","gzip","super","compress","SvgFile","width","height","_compressedSize","then","response","byteLength","URL","createObjectURL","Blob","revokeObjectURL","getXY","obj","x","pageX","y","pageY","touchDistance","touch1","touch2","dx","Math","abs","dy","hypot","getMidpoint","point1","point2","getPoints","touches","touch","PanZoom","eventArea","shouldCaptureFunc","_target","_shouldCaptureFunc","_dx","_dy","_scale","_active","_lastPoints","_onPointerDown","button","preventDefault","_onFirstPointerDown","_onPointerMove","points","averagePoint","averageLastPoint","left","top","getBoundingClientRect","scaleDiff","_update","_onPointerUp","pop","_onWheel","reset","delta","deltaY","deltaMode","max","min","style","transform","SvgOutput","container","_svgFrame","querySelector","_svgContainer","_panZoom","setSvg","nextLoad","_nextLoadPromise","src","encodeURIComponent","onload","prism","highlight","CodeOutput","_codeEl","innerHTML","Output","_types","image","code","_svgFile","_switchQueue","noAnimate","update","svgFile","_activeType","toRemove","toAdd","append","transitions","push","all","Ripple","animate","offsetLeft","FloatingActionButton","title","href","iconSvg","major","classes","setAttribute","_ripple","onClick","Spinner","_showTimeout","display","show","delay","clearTimeout","hide","DownloadButton","_spinner","setDownload","filename","download","working","done","CopyButton","_text","_pre","createElement","copyText","textContent","body","getSelection","removeAllRanges","window","addRange","execCommand","setCopyText","BgFillButton","setColor","color","backgroundColor","round","num","places","mult","floor","humanSize","bytes","Results","_sizeEl","_diffEl","size","comparisonSize","createNanoEvents","events","emit","args","forEach","on","cb","filter","MaterialSlider","rangeElement","_range","_handle","_trackOn","_val","parentNode","insertBefore","firstChild","_onInputChange","_onRangeMouseDown","_onRangeTouchStart","_onRangeTouchEnd","_setPosition","newValue","focus","blur","upListener","percent","Number","Settings","emitter","_throttleTimeout","_pluginInputs","querySelectorAll","_globalInputs","scroller","resetBtn","ranges","_resetRipple","_sliderMap","WeakMap","_onChange","_onReset","closest","oldSettings","getSettings","inputEl","checked","hasAttribute","getAttribute","setSettings","settings","name","plugins","fingerprint","output","join","MainMenu","allowHide","_loadFileInput","_pasteInput","_loadDemoBtn","_loadFileBtn","_pasteLabel","_overlay","_menu","_onMenuButtonClick","_onOverlayClick","_onLoadFileClick","_onLoadDemoClick","_onFileInputChange","_onTextInputChange","stopSpinner","showFilePicker","click","setPasteInput","dispatchEvent","Event","includes","files","fetch","navigator","serviceWorker","controller","Toast","duration","buttons","isError","content","_answerResolve","_hideTimeout","insertAdjacentHTML","answer","buttonElement","Toasts","toast","FileDrop","_activeEnters","_currentEnteredElement","_onDragEnter","_onDragLeave","_onDrop","dataTransfer","Preloader","activated","Changelog","loadedVersion","_loadedVersion","lastLoadedVersion","changelog","json","startIndex","endIndex","entry","entries","version","changeList","slice","array","concat","changes","change","ResultsContainer","results","_results","_container","_mobileContainer","_query","matchMedia","addListener","_positionResults","matches","ViewToggler","ResultsCache","_size","purge","_fingerprints","_items","_index","oldItem","match","indexOf","MainUi","elements","_activated","_toActivate","activate","svgo","_currentJob","svgText","action","process","catch","dimensions","focusMethod","trackFocusMethod","_mainUi","_outputUi","_downloadButtonUi","_copyButtonUi","_resultsUi","_settingsUi","_mainMenuUi","_toastsUi","bgFillUi","dropUi","preloaderUi","changelogUi","self","_resultsContainerUi","viewTogglerUi","_onSettingsChange","_onSettingsReset","_handleError","_onGlobalKeyDown","_onGlobalPaste","_onGlobalCopy","_inputItem","_cache","_latestCompressJobId","_userHasInteracted","_reloading","register","scope","registration","_onUpdateFound","storage","lastSeenVersion","showLogFrom","actionContainer","minorActionContainer","toolbarElement","outputElement","menuExtraElement","_loadSettings","ctrlKey","metaKey","clipboardData","getData","isCollapsed","newWorker","installing","state","location","reload","_saveSettings","_compressSvg","wrapOriginal","_inputFilename","original","settingsToKeep","thisJobId","random","_updateForFile","cacheMatch","compareToFile","resultFile"],"mappings":"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"}